<html>
<head>
    <link rel="stylesheet" type="text/css" href="assets/style.css">
    <script src="assets/promise.min.js"></script>
    <script type="text/javascript">

            window.onload = function() {

              var a = document.getElementById("generateLink");
              a.onclick = function() {
                //console.log("CODE: " + editor.getValue());

                /*qwest.post('/generate', editor.getValue())
                 .then(function(response){
                    // Make some useful actions
                    console.log("RESPONSE: ");
                 })
                 .catch(function(e, url){
                    console.log("ERROR: " + e);
                 });*/

                 promise.post('/generate', editor.getValue()).then(function(error, text, xhr) {
                     if (error) {
                         console.log('Error ' + xhr.status);
                         return;
                     }


                     document.getElementById("generatedImage").src = "http://localhost:8000/"+text;
                     console.log('GOT: '+text);
                 });

                return false;
              }
            }
        </script>
</head>
<body>
<div class="header">
    <h1>Erd Web Server:</h1>
    <h2>Generating Entity-Relationship diagrams from text</h2>
</div>
<div class="main">
    <link rel="stylesheet" href="assets/codemirror.css">
    <script src="assets/codemirror.js"></script>

    <div class="editorArea">
    <textarea id=myTextarea>title {label: "nfldb Entity-Relationship diagram (condensed)", size: "20"}

# Nice colors from Erwiz:
# red #fcecec
# blue #ececfc
# green #d0e0d0
# yellow #fbfbdb
# orange #eee0a0

# Entities

[player] {bgcolor: "#d0e0d0"}
  *player_id {label: "varchar, not null"}
  full_name {label: "varchar, null"}
  team {label: "varchar, not null"}
  position {label: "player_pos, not null"}
  status {label: "player_status, not null"}

[team] {bgcolor: "#d0e0d0"}
  *team_id {label: "varchar, not null"}
  city {label: "varchar, not null"}
  name {label: "varchar, not null"}

[game] {bgcolor: "#ececfc"}
  *gsis_id {label: "gameid, not null"}
  start_time {label: "utctime, not null"}
  week {label: "usmallint, not null"}
  season_year {label: "usmallint, not null"}
  season_type {label: "season_phase, not null"}
  finished {label: "boolean, not null"}
  home_team {label: "varchar, not null"}
  home_score {label: "usmallint, not null"}
  away_team {label: "varchar, not null"}
  away_score {label: "usmallint, not null"}

[drive] {bgcolor: "#ececfc"}
  *+gsis_id {label: "gameid, not null"}
  *drive_id {label: "usmallint, not null"}
  start_field {label: "field_pos, null"}
  start_time {label: "game_time, not null"}
  end_field {label: "field_pos, null"}
  end_time {label: "game_time, not null"}
  pos_team {label: "varchar, not null"}
  pos_time {label: "pos_period, null"}

[play] {bgcolor: "#ececfc"}
  *+gsis_id {label: "gameid, not null"}
  *+drive_id {label: "usmallint, not null"}
  *play_id {label: "usmallint, not null"}
  time {label: "game_time, not null"}
  pos_team {label: "varchar, not null"}
  yardline {label: "field_pos, null"}
  down {label: "smallint, null"}
  yards_to_go {label: "smallint, null"}

[play_player] {bgcolor: "#ececfc"}
  *+gsis_id {label: "gameid, not null"}
  *+drive_id {label: "usmallint, not null"}
  *+play_id {label: "usmallint, not null"}
  *+player_id {label: "varchar, not null"}
  team {label: "varchar, not null"}

[meta] {bgcolor: "#fcecec"}
  version {label: "smallint, null"}
  season_type {label: "season_phase, null"}
  season_year {label: "usmallint, null"}
  week {label: "usmallint, null"}

# Relationships

player      *--1 team
game        *--1 team {label: "home"}
game        *--1 team {label: "away"}
drive       *--1 team
play        *--1 team
play_player *--1 team

game        1--* drive
game        1--* play
game        1--* play_player

drive       1--* play
drive       1--* play_player

play        1--* play_player

player      1--* play_player
</textarea>
</div>
    <script>
      var editor = CodeMirror.fromTextArea(myTextarea, {
        lineNumbers: true
      });

    </script>

<div class="diagramArea">
    <img id="generatedImage" alt="data url loaded image" />
</div>
    <br>
    <a id="generateLink" href="#">Generate Diagram</a>

</div>
</body>
</html>


